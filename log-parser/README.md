# でかプ専用ログパーサー

このツールは、VRCのログを解析してでかプの統計情報をInfluxDBに送信する専用ログパーサーです。
通常は `compose.yml` から参照して利用しますので、基本的に単体で使用することはありません。

ローカルにInfluxDBを立てず、リモートサーバーに直接データを送信したい場合は、このパーサー単体を起動してログを転送することが可能です。（上級者向けです）

この方法を利用すると複数PCからのログを1つのDBサーバーに集約させることが可能です。

## 動作環境

[Python uv](https://github.com/astral-sh/uv)がインストールされていること
(Pythonは3.13をインストールしてください)

## 使用方法

`.env.template` をコピーして `.env` を作成し、必要な値を編集してください。

```bash
uv run main.py
```

## 過去データのロード機能

ログパーサーは新しく追記されたログのみを逐次解析し、過去のログファイルの内容は自動的には処理しません。これはDBにデータが重複して記録されることを防止するためです。

このロード機能を使うことで過去のログデータをまとめて解析してInfluxDBに一括でプッシュすることができます。

### 使用方法

あらかじめ解析対象のログがVRChatのログ保存フォルダにあることを確認してください。
ログの自動削除を防ぐために別の場所に退避している場合はコピペで書き戻してください。

```bash
uv run loader.py
```

※Dockerコンテナ内で実行する際は以下のコマンドで実行してください

```bash
python loader.py
```

1. 解析対象範囲の設定
  実行後、コンソールに「開始日時:」「終了日時:」というプロンプトが表示されます。
  それぞれ `YYYYMMDDHHmmss` 形式で入力してください。日時は日本標準時で解釈されます。
  （例: 2025年10月9日18時35分20秒 => 20251009183520）
  何も入力せずに続行した場合は日時範囲制限をかけずに解析します。
  データ重複防止のために解析範囲を指定することを強く推奨します。

1. 設定内容の確認
  入力した日時の設定内容が表示され、実行の確認がされます。
  問題なければ `y` を入力してください。`n` を入力すると処理が中止されます。

1. ログ解析処理
  指定されたログフォルダから `output_log_*.txt` にマッチするファイルを順次処理します。
  各行ごとに解析し、指定した日時範囲内のデータのみをInfluxDBへ送信します。
